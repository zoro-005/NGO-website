{% extends "layout.html" %}
{% block body %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/donate.css') }}" nonce="{{ csp_nonce }}">

<!-- Hero Section -->
<div class="block-31 block-31-relative">
  <div class="owl-carousel loop-block-31">
    <div class="block-30 block-30-sm item bg-donate" data-stellar-background-ratio="0.5">
      <div class="container">
        <div class="row align-items-center justify-content-center text-center">
          <div class="col-md-8">
            <h2 class="heading text-white text-4xl font-bold">Your Support Saves Stray's Lives</h2>
            <button id="donate-now-btn" class="btn btn-primary mt-4 px-5 py-3" data-target="#donate-section">
              Donate Now
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Donation Section -->
<div class="site-section fund-raisers py-5" id="donate-section">
  <div class="container">
    <div class="row mb-5 justify-content-center">
      <div class="col-md-8 text-center">
        <h2 class="text-3xl font-bold">Join Us in Building a Haven of Hope.</h2>
        <p class="lead mt-3">
          With your support, we can provide abandoned animals with nourishing meals, proper medical treatment,
          and a loving shelter. Let’s come together to create a safe and healthy home where our voiceless
          companions can thrive in dignity
        </p>
        <h2 class="text-3xl font-bold mt-5">Why Your Donation Matters ?</h2>
        <p class="lead mt-3">
          Donations directly support life-saving efforts and improve animal welfare by funding rescue missions, medical treatment, spay/neuter programs, education, shelter, and emergency response. Every contribution, big or small, makes a tangible difference in the lives of animals in need, promoting their well-being and protection.
        </p>
      </div>
    </div>

    <!-- Donation Type Selection -->
    <div class="row justify-content-center mb-4">
      <div class="col-md-6 text-center">
        <div class="form-group">
          <label class="form-label">Select Donation Type</label>
          <div class="d-flex justify-content-center gap-5">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="donation-type" id="indian-donation" value="indian" required>
              <label class="form-check-label mr-2" for="indian-donation">Indian Donation (Razorpay)</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="donation-type" id="overseas-donation" value="overseas">
              <label class="form-check-label" for="overseas-donation">Overseas Donation (PayPal)</label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Indian Donation Form -->
    <div class="row justify-content-center form-wrapper" id="indian-form">
      <div class="col-md-6">
        <div class="card shadow-sm p-4">
          <h3 class="text-center mb-4">Indian Donation</h3>
          <form id="indian-donation-form" class="needs-validation" novalidate>
            <div class="form-group mb-3">
              <label for="indian-donor-name" class="form-label">Full Name</label>
              <input type="text" class="form-control" id="indian-donor-name" placeholder="Enter your name" required>
            </div>
            <div class="form-group mb-3">
              <label for="indian-donor-email" class="form-label">Email Address</label>
              <input type="email" class="form-control" id="indian-donor-email" placeholder="Enter your email" required>
            </div>
            <div class="form-group mb-3">
              <label class="form-label">Donation Amount (₹)</label>
              <div class="d-flex flex-wrap gap-2 mb-3">
                <button type="button" class="btn btn-outline-primary donation-amount" data-amount="500">₹500</button>
                <button type="button" class="btn btn-outline-primary donation-amount" data-amount="1000">₹1000</button>
                <button type="button" class="btn btn-outline-primary donation-amount" data-amount="2000">₹2000</button>
                <button type="button" class="btn btn-outline-primary donation-amount" data-amount="5000">₹5000</button>
              </div>
              <input type="number" class="form-control" id="indian-custom-amount" placeholder="Or enter custom amount" min="1" required>
            </div>
            <button type="button" id="indian-proceed-btn" class="btn btn-primary w-100 py-3">Proceed to Payment</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Overseas Donation Form -->
    <div class="row justify-content-center form-wrapper" id="overseas-form">
      <div class="col-md-6">
        <div class="card shadow-sm p-4">
          <h3 class="text-center mb-4">Overseas Donation (USD only)</h3>
          <form id="overseas-donation-form" class="needs-validation" novalidate>
            <div class="form-group mb-3">
              <label for="overseas-donor-name" class="form-label">Full Name</label>
              <input type="text" class="form-control" id="overseas-donor-name" placeholder="Enter your name" required>
            </div>
            <div class="form-group mb-3">
              <label for="overseas-donor-email" class="form-label">Email Address</label>
              <input type="email" class="form-control" id="overseas-donor-email" placeholder="Enter your email" required>
            </div>
            <div class="form-group mb-3">
              <label class="form-label">Donation Amount ($)</label>
              <div class="d-flex flex-wrap gap-2 mb-3">
                <button type="button" class="btn btn-outline-primary donation-amount" data-amount="5">$5</button>
                <button type="button" class="btn btn-outline-primary donation-amount" data-amount="10">$10</button>
                <button type="button" class="btn btn-outline-primary donation-amount" data-amount="25">$25</button>
                <button type="button" class="btn btn-outline-primary donation-amount" data-amount="50">$50</button>
              </div>
              <input type="number" class="form-control" id="overseas-custom-amount" placeholder="Or enter custom amount" min="1" step="0.01" required>
            </div>
            <div id="paypal-button-container"></div>
          </form>
        </div>
      </div>
    </div>

    <!-- Latest Donations -->
    <!-- <div class="donations-section">
      <div class="h3-center">
        <h3>Recent Supporters</h3>
      </div>
      <div class="donations-grid">
        {% for donor in donors %}
          <div class="donation-card">
            <h4>{{ donor.name }}</h4>
            <span>Donated {{ donor.date.strftime('%b %d, %Y') }}</span>
            <p>
              Donated
              <span>
                {{ '₹' ~ (donor.amount|int) if donor.payment_method == 'razorpay' else '$' ~ '{:.2f}'.format(donor.amount) }}
              </span>
            </p>
          </div>
        {% else %}
          <div class="no-donations">
            <p>No recent donations yet. Be the first to support our cause!</p>
          </div>
        {% endfor %}
      </div>
    </div> -->
  </div>
</div>

<!-- Loading Overlay -->
<div id="loading-overlay" class="overlay overlay--loading">
  <div class="status">
    <div class="spinner-border text-light pulse-animation" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p>Processing your donation...</p>
  </div>
</div>

<!-- Failure Overlay -->
<div id="failure-overlay" class="overlay overlay--failure">
  <div class="box">
    <h3>Payment Failed</h3>
    <p id="failure-message">We’re sorry, your payment could not be processed. Please try again.</p>
    <p id="timer-message"></p>
    <button id="failure-redirect-btn" class="btn btn-primary">Return to Donation</button>
  </div>
</div>

<!-- Config passed via data-* for CSP-safe access in JS -->
<div id="donation-config"
     data-key-id="{{ key_id }}"
     data-logo="{{ url_for('static', filename='images/logo.png') }}">
</div>

<!-- Third-party SDKs (allow these in CSP) -->
<script src="https://checkout.razorpay.com/v1/checkout.js" nonce="{{ csp_nonce }}"></script>
<script src="https://www.paypal.com/sdk/js?client-id={{ paypal_client_id }}&currency=USD" nonce="{{ csp_nonce }}"></script>

<!-- Page JS -->
<script nonce="{{ csp_nonce }}" src="{{ url_for('static', filename='js/donate.js') }}" defer nonce="{{ csp_nonce }}"></script>
{% endblock %}
